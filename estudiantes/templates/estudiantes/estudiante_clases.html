{% extends 'estudiantes/base.html' %}
{% block content %}
<div class="main-content">
  <div class="container mt-5">
    <h3>Mis Clases</h3>
    <div class="list-group" id="lista-clases-estudiante">
      {% for matricula in matriculas %}
      {% with clase=matricula.clase %}
      <button type="button"
        class="list-group-item list-group-item-action btn-ver-detalle-clase"
        data-clase-nombre="{{ clase.curso.nombre }}"
        data-clase-codigo="{{ clase.codigo }}"
        data-clase-nivel="{{ clase.curso.get_nivel_display }}"
        data-clase-profesor="{% if clase.profesor %}{{ clase.profesor.get_full_name }}{% else %}Sin profesor{% endif %}"
        data-clase-aula="{% if clase.aula %}{{ clase.aula.nombre }}{% else %}Sin aula{% endif %}"
        data-clase-fecha-inicio="{{ clase.fecha_inicio|date:'Y-m-d' }}"
        data-clase-fecha-fin="{{ clase.fecha_fin|date:'Y-m-d' }}"
        data-clase-hora-inicio="{{ clase.hora_inicio|time:'H:i' }}"
        data-clase-hora-fin="{{ clase.hora_fin|time:'H:i' }}"
      >
        <div class="d-flex w-100 justify-content-between">
          <h6 class="mb-1">{{ clase.curso.nombre }}</h6>
          <small>{{ clase.hora_inicio|time:"H:i" }} - {{ clase.hora_fin|time:"H:i" }}</small>
        </div>
        <p class="mb-1">
          <span class="badge bg-secondary">{{ clase.codigo }}</span>
          Aula: {% if clase.aula %}{{ clase.aula.nombre }}{% else %}Sin aula{% endif %}
        </p>
        <small>Fecha: {{ clase.fecha_inicio|date:"Y-m-d" }} a {{ clase.fecha_fin|date:"Y-m-d" }}</small>
      </button>
      {% endwith %}
      {% empty %}
      <div class="text-center text-muted">No tienes clases asignadas.</div>
      {% endfor %}
    </div>
  </div>
</div>

<!-- Modal Detalle Clase -->
<div class="modal fade" id="modalDetalleClase" tabindex="-1" aria-labelledby="modalDetalleClaseLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalDetalleClaseLabel">Detalle de la Clase</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          <li class="list-group-item"><strong>CÃ³digo:</strong> <span id="detalle-codigo"></span></li>
          <li class="list-group-item"><strong>Curso:</strong> <span id="detalle-nombre"></span></li>
          <li class="list-group-item"><strong>Nivel:</strong> <span id="detalle-nivel"></span></li>
          <li class="list-group-item"><strong>Profesor:</strong> <span id="detalle-profesor"></span></li>
          <li class="list-group-item"><strong>Aula:</strong> <span id="detalle-aula"></span></li>
          <li class="list-group-item"><strong>Fecha Inicio:</strong> <span id="detalle-fecha-inicio"></span></li>
          <li class="list-group-item"><strong>Fecha Fin:</strong> <span id="detalle-fecha-fin"></span></li>
          <li class="list-group-item"><strong>Hora Inicio:</strong> <span id="detalle-hora-inicio"></span></li>
          <li class="list-group-item"><strong>Hora Fin:</strong> <span id="detalle-hora-fin"></span></li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-ver-detalle-clase').forEach(function(btn) {
      btn.addEventListener('click', function() {
        document.getElementById('detalle-codigo').textContent = btn.getAttribute('data-clase-codigo') || '';
        document.getElementById('detalle-nombre').textContent = btn.getAttribute('data-clase-nombre') || '';
        document.getElementById('detalle-nivel').textContent = btn.getAttribute('data-clase-nivel') || '';
        document.getElementById('detalle-profesor').textContent = btn.getAttribute('data-clase-profesor') || '';
        document.getElementById('detalle-aula').textContent = btn.getAttribute('data-clase-aula') || '';
        document.getElementById('detalle-fecha-inicio').textContent = btn.getAttribute('data-clase-fecha-inicio') || '';
        document.getElementById('detalle-fecha-fin').textContent = btn.getAttribute('data-clase-fecha-fin') || '';
        document.getElementById('detalle-hora-inicio').textContent = btn.getAttribute('data-clase-hora-inicio') || '';
        document.getElementById('detalle-hora-fin').textContent = btn.getAttribute('data-clase-hora-fin') || '';
        var modal = new bootstrap.Modal(document.getElementById('modalDetalleClase'));
        modal.show();
      });
    });
  });
</script>
{% endblock %}
