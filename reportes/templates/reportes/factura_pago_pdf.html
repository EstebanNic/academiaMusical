{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <title>Factura de Pago - Academia Musical</title>
    <style>
        @page { size: A4; margin: 1cm; }
        body { font-family: Arial, sans-serif; font-size: 11px; color: #333; }
        .header { text-align: center; margin-bottom: 18px; }
        .header h1 { color: #007bff; font-size: 20px; margin: 0; }
        .header h2 { color: #555; font-size: 14px; margin: 0; }
        .info { margin-bottom: 12px; }
        .info-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .info-table td { padding: 4px 8px; }
        .abonos-table { width: 100%; border-collapse: collapse; margin-bottom: 10px; }
        .abonos-table th, .abonos-table td { border: 1px solid #ddd; padding: 6px; text-align: center; }
        .abonos-table th { background-color: #007bff; color: #fff; }
        .estado-pagado { color: #28a745; font-weight: bold; }
        .estado-pendiente { color: #dc3545; font-weight: bold; }
        .footer { text-align: center; font-size: 10px; color: #666; margin-top: 18px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Academia Musical</h1>
        <h2>Factura de Pago</h2>
    </div>
    <div class="info">
        <table class="info-table">
            <tr>
                <td><strong>Estudiante:</strong></td>
                <td>{{ pago.matricula.estudiante.get_full_name }}</td>
            </tr>
            <tr>
                <td><strong>Cédula:</strong></td>
                <td>{{ pago.matricula.estudiante.cedula }}</td>
            </tr>
            <tr>
                <td><strong>Curso:</strong></td>
                <td>{{ pago.matricula.clase.curso.nombre }}</td>
            </tr>
            <tr>
                <td><strong>Fecha Matrícula:</strong></td>
                <td>{{ pago.matricula.fecha_matricula }}</td>
            </tr>
            <tr>
                <td><strong>Monto Total:</strong></td>
                <td>$ {{ pago.monto|floatformat:2 }}</td>
            </tr>
            <tr>
                <td><strong>Monto Restante:</strong></td>
                <td>$ {{ pago.saldo_pendiente|floatformat:2 }}</td>
            </tr>
            <tr>
                <td><strong>Estado:</strong></td>
                <td>
                    {% if pago.estado == 'PAGADO' %}
                        <span class="estado-pagado">Pagado</span>
                    {% else %}
                        <span class="estado-pendiente">Pendiente</span>
                    {% endif %}
                </td>
            </tr>
        </table>
    </div>
    <h4>Detalle de Abonos</h4>
    <table class="abonos-table">
        <thead>
            <tr>
                <th>#</th>
                <th>Monto Abonado</th>
                <th>Fecha</th>
            </tr>
        </thead>
        <tbody>
            {% for abono in pago.pagos_parciales.all %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>$ {{ abono.monto|floatformat:2 }}</td>
                <td>{{ abono.fecha }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="3" style="text-align:center;">No hay abonos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="footer">
        Factura generada el {{ fecha_generacion|date:"d/m/Y H:i" }} por {{ usuario_generador.get_full_name|default:usuario_generador.username }}<br>
        {% if pago.estado == 'PAGADO' %}
            <strong>¡Pago completado!</strong>
        {% else %}
            <strong>Pago pendiente. Monto restante: ${{ pago.saldo_pendiente|floatformat:2 }}</strong>
        {% endif %}
    </div>
</body>
</html>
</body>
</html>
